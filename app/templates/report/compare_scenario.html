{% extends 'scenario/scenario_results_page.html' %}
{% load static %}
{% load custom_filters %}
{% load custom_template_tags %}
{% load i18n %}


{% block title %}{% translate "Compare Scenarios" %}{% endblock title %}


{% block dashboard %}

    <section class="dashboard">
        <div>
            <div class="row">
                <div class="dashboard__scenarios">
                    <h2>{% translate "My scenarios" %}</h2>
                    <div class="scenario-select">
                        {% for scenario in scenario_list %}
                        {% if scenario.id|stringformat:'s' in request|get_selected_scenarios:proj_id %}
                            {% setvar "selected" as selected %}
                        {% else%}
                            {% setvar "" as selected %}
                        {% endif %}
                            <button id="scenario-{{ proj_id }}-{{ scenario.id}}" class="scenario-select__item {{ selected }}" onclick="update_selected_multi_scenarios(this)">
                                {{ scenario.name }}
                            </button>
                        {% empty %}
                            {% translate "You have no scenario with completed simulation, please run simulations to display results" %}
                        {% endfor %}

                    </div>
                </div>
            </div>
            {% if scenario_list %}
                <div class="row dashboard__create">
                    <div class="col">
                      <button class="btn btn--medium" onclick="javascript:showCreateReportItemModal(event)">
                        <span class="icon icon-add"></span>
                        {% translate "Create graph" %}
                      </button>
                    </div>
                </div>
            {% endif %}
            <div class="row">
                <div class="col" id="report_items">

                {% include "report/graph_template.html" with id="all_timeseries" title="All timeseries" %}
                {% include "report/graph_template.html" with id="capacities" title="Installed and optimized capacities" %}

                </div>
            </div>
        </div>
    </section>

{% endblock dashboard %}


{% block results_end_body_scripts %}
<script>

$(document).ready(function () {
    // add search field to the kpi info modal
    $('#kpiTable').DataTable();
    // update the kpi table
    //update_kpi_table_style(document.getElementById("kpi-table-style"));
    scenario_visualize_timeseries();
    scenario_visualize_capacities();
});

function update_selected_multi_scenarios(target){
    const proj_id = target.id.split("-")[1];
    const scen_id = target.id.split("-")[2];

    if(scen_id != null){
        $.ajax({
            url: "{% url 'update_selected_multi_scenarios' proj_id %}" + scen_id,
            type: "GET",
            success: async (data) => {
                await target.classList.toggle("selected");
                //call functions which update graphs below

                /* Update the kpi table */
                //update_kpi_table_style(document.getElementById("kpi-table-style"));

                scenario_visualize_timeseries();
                scenario_visualize_capacities();
            },
            error: function (xhr, errmsg) {
                if (xhr.status != 405){
                    console.log("backend_error!")
                    //Show the error message
                    $('#message-div').html("<div class='alert-error'>" +
                        "<strong>Success: </strong> We have encountered an error: " + errmsg + "</div>");
                }
            }
        });
    }
}

document.getElementById('compare-scenario-link').classList.add('active');
</script>
{% endblock results_end_body_scripts %}